@startuml
'https://plantuml.com/activity-diagram
title Диаграмма деятельности PreVisor

|Система|
start
:Сбор данных из сети (real-трафик);
:Автоматический мониторинг (циклический запуск в фоне);
:Предобработка (очистка, нормализация, feature engineering);
:Анализ угроз (ML-классификатор + эвристики + IsolationForest);
:Опционально: обогащение репутацией IP (AbuseIPDB);

if (Обнаружен риск выше порога?) then (Да)
  :Генерация алерта (JSON);
  :Сохранение в БД (alerts);
  :Отправка уведомления в Telegram;
  :Кэширование репутации IP (ip_cache);
else (Нет)
  :Запись трафика в журнал (traffic_logs);
endif
:Обновление дашборда;

|Пользователь|
:Открытие веб-интерфейса;
:Просмотр алертов и статистики;
if (Нужен ручной запуск?) then (Да)
  :Нажатие "Запустить анализ";
  :Flask инициирует сбор/предобработку
  и повторный анализ данных;
endif
:Обновление статусов алертов;
:Продолжение мониторинга;

|Внешние источники|
:Threat Intelligence (AbuseIPDB, опционально);

stop
@enduml
