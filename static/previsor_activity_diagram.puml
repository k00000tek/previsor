@startuml
'https://plantuml.com/activity-diagram
title Диаграмма деятельности PreVisor

|Система|
start
:Сбор данных из сети\n(реальный / тестовый / симулированный трафик);
:Запуск по расписанию (Celery beat,\nкаждые 10 минут);
:Предобработка (очистка,\nнормализация, feature engineering);

:Анализ угроз (ML-классификатор\n+ аномалист IsolationForest);
:Обогащение алертов репутацией IP\n(Threat Intelligence API);

if (Обнаружен риск выше порога?) then (Да)
  :Генерация алерта (JSON);
  :Сохранение в БД (таблица alerts);
  fork
    :Отправка уведомления\n(email/Slack/мессенджер);
  fork again
    :Кэширование репутации IP\n(таблица ip_cache);
  end fork
else (Нет)
  :Запись результатов анализа\nв журнал трафика (traffic_logs);
endif
:Обновление дашборда;

|Пользователь|
:Авторизация в веб-интерфейсе;
:Просмотр графиков и алертов;
:Фильтрация и экспорт отчётов;
if (Требуется ручной анализ?) then (Да)
  :Загрузка файла / нажатие\n"Запустить анализ";
  :Передача запроса Flask-приложению;
  :Flask инициирует предобработку\nи повторный анализ данных;
endif
:Отметка статуса алертов\n(new/ack/false_positive);
:Продолжение мониторинга;

|Внешние источники|
:Предоставление данных по IP/сигнатурам\n(AbuseIPDB, VirusTotal и др.);

stop
@enduml
