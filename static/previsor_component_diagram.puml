@startuml
title Диаграмма компонентов PreVisor
skinparam componentStyle rectangle

package "Core System" {
  [Threat Pipeline]
  [Data Collector]
  [Preprocessor]
  [Heuristics]
  [Classifier]
  [Anomaly Detector]
  [API Integration]
  [Baseline Manager]
}

package "Presentation Layer" {
  [Web App]
}

package "Runtime Monitor" {
  [Collector Thread]
  [Processor Thread]
  [Queue]
  [Telegram Polling]
}

database "Data Storage" {
  [SQLite]
}

cloud "External Services" {
  [Threat Intelligence]
  [Telegram Bot]
}

' Connections
[Collector Thread] --> [Data Collector] : collect
[Data Collector] --> [Queue] : enqueue
[Queue] --> [Processor Thread] : dequeue
[Processor Thread] --> [Threat Pipeline] : analyse

[Threat Pipeline] --> [Preprocessor] : preprocess
[Threat Pipeline] --> [Heuristics] : heuristics
[Threat Pipeline] --> [Classifier] : classify
[Threat Pipeline] --> [Anomaly Detector] : detect

[Threat Pipeline] --> [SQLite] : logs
[API Integration] --> [SQLite] : cache

[Web App] --> [SQLite] : CRUD
[Web App] --> [Threat Pipeline] : manual run
[Web App] --> [Collector Thread] : monitor control
[Web App] --> [Baseline Manager] : retrain IF
[Baseline Manager] --> [SQLite] : baseline

[Classifier] --> [API Integration] : check IP
[API Integration] --> [Threat Intelligence] : HTTP

[Web App] --> [Telegram Bot] : alert
[Telegram Polling] --> [Telegram Bot] : get updates
[Telegram Polling] --> [Web App] : handle commands
@enduml
