@startuml
title Диаграмма компонентов PreVisor

skinparam componentStyle rectangle
skinparam rectangle {
  BackgroundColor White
  BorderColor #777
  FontColor Black
}
skinparam package {
  BackgroundColor #F9F9F9
  BorderColor #999
}
skinparam database {
  BackgroundColor #FFF9F2
  BorderColor #CCAA77
}
skinparam cloud {
  BackgroundColor #F5FAFF
  BorderColor #8FB6E6
}

package "Core System" {
  [Data Collector\n(modules.data_collector)]
  [Preprocessor\n(modules.preprocessor)]

  package "Threat Analysis" {
    [Classifier Analyzer\n(modules.analyzer)]
    [Anomaly Detector\n(modules.anomaly_detector)]
    [API Integration\n(utils.api_integration)]
  }
}

package "Presentation Layer" {
  [Flask Web App\n(app.py, templates/dashboard.html)]
}

database "Data Storage" {
  [SQLite DB\n(db/previsor.db)]
}

package "Background Tasks" {
  [Celery Worker\n(celery_app.py)]
}

cloud "External Services (Optional)" {
  [Threat Intelligence API\n(AbuseIPDB, VirusTotal)]
  [Notification Channels\n(SMTP, Slack, etc.)]
}

' === Связи ===
[Data Collector\n(modules.data_collector)] --> [Preprocessor\n(modules.preprocessor)] : raw traffic
[Preprocessor\n(modules.preprocessor)] --> [Classifier Analyzer\n(modules.analyzer)] : feature matrix
[Preprocessor\n(modules.preprocessor)] --> [Anomaly Detector\n(modules.anomaly_detector)] : feature matrix

[Classifier Analyzer\n(modules.analyzer)] --> [SQLite DB\n(db/previsor.db)] : alerts
[Anomaly Detector\n(modules.anomaly_detector)] --> [SQLite DB\n(db/previsor.db)] : anomaly alerts
[API Integration\n(utils.api_integration)] --> [SQLite DB\n(db/previsor.db)] : ip_cache

[Flask Web App\n(app.py, templates/dashboard.html)] --> [SQLite DB\n(db/previsor.db)] : read alerts/logs
[Flask Web App\n(app.py, templates/dashboard.html)] --> [Classifier Analyzer\n(modules.analyzer)] : manual analysis request

[Classifier Analyzer\n(modules.analyzer)] --> [API Integration\n(utils.api_integration)] : check IP reputation
[API Integration\n(utils.api_integration)] --> [Threat Intelligence API\n(AbuseIPDB, VirusTotal)] : HTTP requests

[Celery Worker\n(celery_app.py)] --> [Data Collector\n(modules.data_collector)] : scheduled collect
[Celery Worker\n(celery_app.py)] --> [Preprocessor\n(modules.preprocessor)] : scheduled preprocess
[Celery Worker\n(celery_app.py)] --> [Classifier Analyzer\n(modules.analyzer)] : scheduled analysis

[Classifier Analyzer\n(modules.analyzer)] --> [Notification Channels\n(SMTP, Slack, etc.)] : alerts / notify

[Flask Web App\n(app.py, templates/dashboard.html)] --> [Notification Channels\n(SMTP, Slack, etc.)] : optional user actions

@enduml
