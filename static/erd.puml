@startuml
title ER-диаграмма БД PreVisor

' Стиль (по желанию)
hide circle
hide methods
hide stereotypes

skinparam entity {
  BackgroundColor White
  BorderColor #555555
  FontColor #111111
}

' === Сущности ===

entity "ip_cache" as IPCache {
  * ip : VARCHAR <<PK>>
  --
  reputation : FLOAT
  last_check : DATETIME
  source : VARCHAR
}

entity "alerts" as Alerts {
  * id : INTEGER <<PK>>
  --
  timestamp       : DATETIME
  source_ip       : VARCHAR
  dest_port       : INTEGER
  alert_type      : VARCHAR
  model_type      : VARCHAR
  probability     : FLOAT
  severity        : VARCHAR
  status          : VARCHAR
  detection_source: VARCHAR
  ip_cache_ip     : VARCHAR <<FK>>
}

entity "traffic_logs" as TrafficLogs {
  * id : INTEGER <<PK>>
  --
  timestamp    : DATETIME
  source_ip    : VARCHAR
  dest_ip      : VARCHAR
  dest_port    : INTEGER
  protocol     : VARCHAR
  packet_count : INTEGER
  flow_duration: BIGINT
  is_alert     : BOOLEAN
  alert_id     : INTEGER <<FK>>
}

' === Связи ===
IPCache ||--o{ Alerts : "1 : N\n(ip → alerts)"
TrafficLogs ||--o{ Alerts : "0..1 : N\n(log → alerts)"

' Пояснение:
' - ip_cache.ip      ↔ alerts.ip_cache_ip
' - alerts.id        ↔ traffic_logs.alert_id (если запись лога породила алерт)
' - source_ip в alerts и traffic_logs дублируется для удобства фильтрации

@enduml
